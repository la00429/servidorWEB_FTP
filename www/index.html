<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servidor Web con FTP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f3f4f6 0%, #e9effd 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 3rem;
            max-width: 980px;
            margin: 2rem;
            text-align: left;
        }

        /* Landing hero */
        .site-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border-radius: 14px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .site-hero h1 {
            color: #fff;
            font-size: 2.2rem;
            margin-bottom: 0.25rem;
        }
        .site-hero p { color: #e9f0ff; margin-bottom: 0.75rem; }
        .hero-cta { display: flex; flex-wrap: wrap; gap: 0.6rem; }
        .btn.light { background: #fff; color: #4a56a6; }
        .btn.white-outline { background: transparent; border: 1px solid #fff; color: #fff; }
        .quick-nav { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
        .quick-nav a { color: #fff; opacity: 0.9; text-decoration: underline; font-weight: 600; }

        /* Hero/Banner del informe */
        .report-hero {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            background: linear-gradient(135deg, #edf2ff 0%, #e6fffa 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.25rem 1.25rem 1rem;
            margin: 1rem 0 1.25rem;
        }
        .report-hero h2 {
            margin: 0 0 0.25rem;
            color: #2d3748;
        }
        .report-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem 0.75rem;
            color: #4a5568;
            font-size: 0.95rem;
        }
        .badges { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.25rem; }
        .badge { background: #4c51bf; color: #fff; padding: 0.2rem 0.6rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; }
        .badge.alt { background: #319795; }
        .hero-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.25rem; }
        .btn.outline { background: transparent; color: #4c51bf; border: 1px solid #4c51bf; }
        .btn.ghost { background: transparent; color: #4a5568; border: 1px solid #cbd5e0; }
        .divider { height: 1px; background: #e2e8f0; margin: 0.75rem 0; }

        h1 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 2.5rem;
        }

        h2 {
            color: #667eea;
            margin: 2rem 0 1rem;
            font-size: 1.6rem;
        }

        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .service {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .service h3 {
            color: #4a5568;
            margin-bottom: 0.5rem;
        }

        .service p {
            color: #718096;
            font-size: 0.9rem;
        }

        .status {
            display: inline-block;
            background: #48bb78;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 0.5rem 0;
        }

        .info-box {
            background: #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: left;
        }

        .info-box h4 {
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .info-box code {
            background: #4a5568;
            color: #e2e8f0;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .actions {
            margin-top: 1.5rem;
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            text-align: left;
        }

        .btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            text-decoration: none;
        }

        .btn.secondary {
            background: #4a5568;
        }

        footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
            color: #718096;
            font-size: 0.9rem;
            Text-align: center
        }

        /* Tabs */
        .tabs {
            margin-top: 1.25rem;
        }
        .tablist {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            border-bottom: 1px solid #e2e8f0;
            margin-top: 1rem;
        }
        .tablist button {
            background: transparent;
            border: 0;
            color: #4a5568;
            padding: 0.6rem 1rem;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            transition: color 200ms ease, background-color 200ms ease;
        }
        .tablist button[aria-selected="true"] {
            background: #edf2f7;
            color: #2d3748;
        }
        .tab-panels {
            position: relative;
            overflow: visible;
        }
        .tab-panel {
            display: none;
            opacity: 0;
            transform: translateY(6px);
            transition: opacity 220ms ease, transform 220ms ease;
        }
        .tab-panel.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        /* Content helpers */
        .lead {
            color: #4a5568;
            margin-bottom: 0.75rem;
        }
        .table-of-contents ul {
            list-style: none;
            padding-left: 0;
        }
        .table-of-contents ul li a {
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            display: block;
            padding: 0.4rem 0;
            transition: color 0.2s ease;
        }
        .table-of-contents ul li a:hover { color: #5a67d8; }
        .table-of-contents ul ul { padding-left: 20px; list-style: circle; }
        .gantt-diagram { max-width: 100%; height: auto; display: block; margin: 1rem auto; border: 1px solid #e2e8f0; border-radius: 8px; }

        /* Secciones tipo card */
        .card {
            background: #ffffff;
            border: 1px solid #edf2f7;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.04);
            margin: 1rem 0;
        }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 860px) { .grid-2 { grid-template-columns: 1fr; } }
        .section-title { display: flex; align-items: center; gap: 0.5rem; }
        .section-title::before { content: ''; width: 8px; height: 24px; background: #667eea; border-radius: 4px; display: inline-block; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Documentación de Proyecto:</h1>

        <div class="tabs" id="tabs">
            <div class="tablist" role="tablist" aria-label="Navegación de secciones">
                <button role="tab" aria-selected="true" aria-controls="tab-servicios" id="tab-servicios-btn">Servicios</button>
                <button role="tab" aria-selected="false" aria-controls="tab-archivos" id="tab-archivos-btn">Subir y descargar</button>
            </div>

            <div class="tab-panels">
                <section id="tab-servicios" class="tab-panel active" role="tabpanel" aria-labelledby="tab-servicios-btn">
                    <h2>Servicios: Funcionamiento, configuración, problemas y pasos de instalación</h2>
                    
                    <!-- Carrusel de servicios -->
                    <section class="card" id="servicios-carrusel" aria-label="Carrusel de servicios">
                        <style>
                            .carousel { position: relative; overflow: hidden; border-radius: 12px; border: 1px solid #e2e8f0; }
                            .carousel-track { display: flex; transition: transform 300ms ease; }
                            .carousel-slide { min-width: 100%; padding: 1.25rem; background: #ffffff; }
                            .carousel-title { color: #2d3748; margin-bottom: 0.5rem; font-size: 1.15rem; }
                            .carousel-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 0.6rem; }
                            .carousel-arrow { background: #667eea; color: #fff; border: 0; border-radius: 8px; padding: 0.4rem 0.8rem; cursor: pointer; }
                            .carousel-dots { display: flex; gap: 6px; align-items: center; }
                            .dot { width: 10px; height: 10px; border-radius: 50%; background: #cbd5e0; cursor: pointer; }
                            .dot.active { background: #667eea; }
                            .muted { color: #4a5568; }
                            .small { font-size: 0.95rem; }
                        </style>
                        <div class="carousel" id="carousel">
                            <div class="carousel-track" id="carouselTrack">
                                <div class="carousel-slide">
                                    <span id="servicios-dhcp"></span>
                                    <h4 class="carousel-title">1. DHCP (Fedora Server)</h4>
                                    <h5 class="muted">Funcionamiento</h5>
                                    <p class="small">Proporciona parámetros IP automáticamente mediante el ciclo DORA (Discover, Offer, Request, Ack) y gestiona concesiones.</p>
                                    <h5 class="muted">Configuración</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code>sudo dnf install -y dhcp-server
sudo nano /etc/dhcp/dhcpd.conf
# ejemplo: red 192.168.10.0/24, rango 192.168.10.100-200
subnet 192.168.10.0 netmask 255.255.255.0 {
  range 192.168.10.100 192.168.10.200;
  option domain-name-servers 192.168.10.2;
}

# Elegir interfaz
sudo sh -c 'echo DHCPDARGS=ens33 > /etc/sysconfig/dhcpd'

sudo systemctl enable --now dhcpd
sudo firewall-cmd --permanent --add-service=dhcp
sudo firewall-cmd --reload</code></pre>
                                    <h5 class="muted">Problemas y soluciones</h5>
                                    <ul class="small">
                                        <li>Servicio no levanta: revisar <code>journalctl -u dhcpd -xe</code> y sintaxis de <code>dhcpd.conf</code></li>
                                        <li>Sin arrendamientos: confirmar interfaz en <code>/etc/sysconfig/dhcpd</code> y VLANs</li>
                                        <li>Firewall bloquea: habilitar servicio DHCP y recargar reglas</li>
                                    </ul>
                                    <h5 class="muted">Pasos de instalación</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code>sudo dnf update -y
sudo dnf install -y dhcp-server
sudo nano /etc/dhcp/dhcpd.conf
sudo systemctl enable --now dhcpd</code></pre>
                                    <h5 class="muted">Archivos clave</h5>
                                    <ul class="small">
                                        <li><code>/etc/dhcp/dhcpd.conf</code></li>
                                        <li><code>/var/lib/dhcpd/dhcpd.leases</code></li>
                                        <li><code>/etc/sysconfig/dhcpd</code></li>
                                    </ul>
                                </div>
                                <div class="carousel-slide">
                                    <span id="servicios-dns"></span>
                                    <h4 class="carousel-title">2. DNS (BIND en Fedora)</h4>
                                    <h5 class="muted">Funcionamiento</h5>
                                    <p class="small">Resuelve nombres a IP mediante consultas recursivas, autoridad y caché. Usa registros como A, AAAA, CNAME, MX.</p>
                                    <h5 class="muted">Configuración</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code>sudo dnf install -y bind bind-utils
sudo nano /etc/named.conf
# Incluir zona
zone "grupo04.com" IN {
  type master;
  file "/var/named/grupo04.com.zone";
};

sudo nano /var/named/grupo04.com.zone
$TTL 1H
@   IN SOA ns1.grupo04.com. admin.grupo04.com. (
        2025010101 1H 15M 1W 1H )
    IN NS ns1
ns1 IN A 192.168.1.2
@ IN A 192.168.1.3
www IN A 192.168.1.3

sudo chown named:named /var/named/Grupo04.com.zone
sudo chmod 640 /var/named/Grupo04.com.zone
sudo systemctl enable --now named
sudo firewall-cmd --permanent --add-service=dns && sudo firewall-cmd --reload</code></pre>
                                    <h5 class="muted">Problemas y soluciones</h5>
                                    <ul class="small">
                                        <li>Zona no carga: revisar <code>/var/log/messages</code> y <code>named-checkconf</code>/<code>named-checkzone</code></li>
                                        <li>Sin respuesta: verificar firewall y escucha en <code>127.0.0.1, 0.0.0.0</code></li>
                                        <li>Registros erróneos: validar TTL, SOA y serial</li>
                                    </ul>
                                    <h5 class="muted">Pasos de instalación</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code>sudo dnf update -y
sudo dnf install -y bind bind-utils
sudo systemctl enable --now named</code></pre>
                                    <h5 class="muted">Archivos clave</h5>
                                    <ul class="small">
                                        <li><code>/etc/named.conf</code></li>
                                        <li><code>/var/named/*.zone</code></li>
                                    </ul>
                                </div>
                                <div class="carousel-slide">
                                    <span id="servicios-nginx"></span>
                                    <h4 class="carousel-title">3. Servidor Web (NGINX en Docker)</h4>
                                    <h5 class="muted">Funcionamiento</h5>
                                    <p class="small">Servidor HTTP estático/reverso. En este proyecto sirve contenido de <code>www/</code> por el puerto 80 dentro de un contenedor.</p>
                                    <h5 class="muted">Configuración</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code># Docker Compose (extracto)
services:
  nginx:
    image: nginx:stable
    ports:
      - "80:80"
    volumes:
      - ./www:/usr/share/nginx/html:ro
      - ./configs/nginx.conf:/etc/nginx/nginx.conf:ro</code></pre>
                                    <h5 class="muted">Problemas y soluciones</h5>
                                    <ul class="small">
                                        <li>Error 404: verificar ruta del volumen <code>./www</code> y permisos</li>
                                        <li>Nginx no arranca: validar <code>nginx.conf</code> con <code>nginx -t</code> dentro del contenedor</li>
                                        <li>Puerto en uso: liberar 80 o mapear a otro, p. ej. <code>8080:80</code></li>
                                    </ul>
                                    <h5 class="muted">Pasos de instalación</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code>docker compose up -d nginx
# logs
docker compose logs -f nginx</code></pre>
                                    <h5 class="muted">Archivos clave</h5>
                                    <ul class="small">
                                        <li><code>configs/nginx.conf</code></li>
                                        <li><code>www/</code></li>
                                    </ul>
                                </div>
                                <div class="carousel-slide">
                                    <span id="servicios-vsftpd"></span>
                                    <h4 class="carousel-title">4. Servidor de Archivos (VSFTPD en Docker)</h4>
                                    <h5 class="muted">Funcionamiento</h5>
                                    <p class="small">FTP para subir/descargar. VSFTPD expone puerto 21 y un rango pasivo mapeado al host.</p>
                                    <h5 class="muted">Configuración</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code># Docker Compose (extracto)
services:
  vsftpd:
    image: fauria/vsftpd
    ports:
      - "21:21"
      - "21100-21110:21100-21110"
    environment:
      - FTP_USER=ftpuser
      - FTP_PASS=ftppass123
      - PASV_MIN_PORT=21100
      - PASV_MAX_PORT=21110
    volumes:
      - ./ftp-data:/home/vsftpd</code></pre>
                                    <h5 class="muted">Problemas y soluciones</h5>
                                    <ul class="small">
                                        <li>Conexión pasiva falla: abrir puertos 21100-21110 en firewall/router</li>
                                        <li>Permisos: ajustar permisos de <code>ftp-data/</code> para escritura del usuario</li>
                                        <li>Cliente no lista: forzar modo pasivo en el cliente</li>
                                    </ul>
                                    <h5 class="muted">Pasos de instalación</h5>
                                    <pre class="small" style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;"><code>docker compose up -d vsftpd
# probar con cliente FTP (p. ej. FileZilla)</code></pre>
                                    <h5 class="muted">Rutas y puertos</h5>
                                    <ul class="small">
                                        <li><code>ftp-data/</code> (datos)</li>
                                        <li>Puerto <code>21</code> y pasivos <code>21100-21110</code></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-nav">
                            <button class="carousel-arrow" id="prevSlide" aria-label="Anterior">←</button>
                            <div class="carousel-dots" id="carouselDots" aria-label="Paginación"></div>
                            <button class="carousel-arrow" id="nextSlide" aria-label="Siguiente">→</button>
                        </div>
                    </section>

                    <!-- Tabla de contenidos eliminada para enfoque en carrusel -->

                    <!-- Secciones largas eliminadas; ahora todo vive en el carrusel -->
                </section>

                <section id="tab-archivos" class="tab-panel" role="tabpanel" aria-labelledby="tab-archivos-btn">
                    <h2>Subir y descargar archivos</h2>
        <div class="grid-2">
            <div class="card">
                            <h3 class="section-title">Descargas</h3>
                <p>Descarga el informe técnico en PDF o visita la carpeta de descargas del servidor web.</p>
            <div class="actions">
                <button class="btn" id="generatePdfBtn" onclick="generateAndDownloadPDF()">Descargar Informe PDF</button>
                <a class="btn secondary" href="/downloads/" target="_blank">Ver carpeta de descargas</a>
                <div id="pdfStatus" style="margin-top: 10px; font-size: 0.9rem; color: #666;"></div>
            </div>
        </div>
            <div class="card">
                            <h3 class="section-title">Subir archivos (FTP vía backend)</h3>
                <p>Utiliza el formulario para subir archivos al servidor a través del endpoint <code>/upload</code>.</p>
                <form id="uploadForm" style="margin-top: 0.5rem;">
                <input type="file" id="fileInput" name="file" required />
                <button class="btn" type="submit">Subir</button>
                <span id="uploadStatus"></span>
            </form>
            </div>
                    </div>
                </section>

            </div>
        </div>

        <footer>
            <p>Universidad Pedagógica y Tecnológica de Colombia</p>
            <p>Redes de Datos</p>
        </footer>
    </div>
    <script>
        // Tabs logic (accessible)
        const tabButtons = Array.from(document.querySelectorAll('.tablist [role="tab"]'));
        const tabPanels = Array.from(document.querySelectorAll('.tab-panel'));

        function activateTab(button) {
            tabButtons.forEach(btn => btn.setAttribute('aria-selected', String(btn === button)));
            tabPanels.forEach(panel => {
                const isActive = panel.id === button.getAttribute('aria-controls');
                panel.classList.toggle('active', isActive);
            });
            // Optional: update hash
            const id = button.getAttribute('aria-controls');
            if (id) location.hash = id;
        }

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => activateTab(btn));
            btn.addEventListener('keydown', (e) => {
                const idx = tabButtons.indexOf(btn);
                if (e.key === 'ArrowRight') {
                    const next = tabButtons[(idx + 1) % tabButtons.length];
                    next.focus();
                    activateTab(next);
                } else if (e.key === 'ArrowLeft') {
                    const prev = tabButtons[(idx - 1 + tabButtons.length) % tabButtons.length];
                    prev.focus();
                    activateTab(prev);
                }
            });
        });

        // Activate from hash on load
        window.addEventListener('load', () => {
            const hash = location.hash.replace('#', '');
            if (!hash) return;
            const targetBtn = tabButtons.find(b => b.getAttribute('aria-controls') === hash);
            if (targetBtn) activateTab(targetBtn);
        });

        const form = document.getElementById('uploadForm');
        const statusEl = document.getElementById('uploadStatus');
        form?.addEventListener('submit', async (e) => {
            e.preventDefault();
            statusEl.textContent = 'Subiendo...';
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const data = new FormData();
            data.append('file', file);
            try {
                const res = await fetch('/upload', {
                    method: 'POST',
                    body: data
                });
                const json = await res.json();
                if (json.ok) {
                    statusEl.textContent = `Subido: ${json.filename}`;
                } else {
                    statusEl.textContent = `Error: ${json.error || 'Desconocido'}`;
                }
            } catch (err) {
                statusEl.textContent = 'Error de red al subir';
            }
        });

        // Función para generar y descargar PDF
        async function generateAndDownloadPDF() {
            const btn = document.getElementById('generatePdfBtn');
            const status = document.getElementById('pdfStatus');
            
            if (btn) btn.disabled = true;
            if (btn) btn.textContent = 'Preparando...';
            if (status) status.textContent = 'Preparando el informe técnico para descarga...';
            
            try {
                const sourceSection = document.getElementById('servicios-carrusel');
                if (!sourceSection) throw new Error('Sección de servicios no encontrada');

                const printableHtml = `<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Informe Técnico - Servicios</title>
<style>
@page { size: A4; margin: 2cm; }
body { font-family: 'Times New Roman', serif; color: #2d3748; line-height: 1.6; font-size: 12pt; }
h1, h2, h3, h4, h5 { color: #1a202c; }
code { background: #f8f9fa; border: 1pt solid #e9ecef; padding: 2pt 4pt; font-family: 'Courier New', monospace; font-size: 10pt; border-radius: 2pt; }
.print-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 18px 22px; border-radius: 10px; margin-bottom: 18px; }
.print-header h1 { color: #fff; margin: 0 0 6px; font-size: 20pt; }
.print-meta { display: flex; flex-wrap: wrap; gap: 8px 14px; font-size: 10pt; opacity: 0.95; }
.pill { display: inline-block; background: rgba(255,255,255,0.15); color: #fff; padding: 2px 8px; border-radius: 999px; font-size: 9pt; margin-right: 6px; }
.toolbar { display: flex; gap: 8px; margin-top: 10px; }
.toolbar button { background: #fff; color: #4a5568; border: 0; border-radius: 6px; padding: 6px 10px; cursor: pointer; }
@media print { .toolbar { display: none; }
.carousel { position: static !important; overflow: visible !important; }
.carousel-track { display: block !important; transform: none !important; }
.carousel-slide { min-width: auto !important; padding: 1rem 0 !important; border-bottom: 1pt solid #e2e8f0; margin-bottom: 1rem; }
.carousel-nav { display: none !important; }
}
</style>
</head>
<body>
<div class="print-header">
  <h1>Informe Técnico: Servicios DHCP, DNS, NGINX y VSFTPD</h1>
  <div class="print-meta">
    <span>Grupo: David Santiago Lotero Rodríguez, Luis Eduardo Hernandez Rincon, Laura Vanessa Figueredo Martínez, Juan Sebastian Joe Felipe Rodriguez Mateus</span>
    <span>•</span>
    <span>Docente: Ing. Frey Alfonso Santamaría Buitrago</span>
    <span>•</span>
    <span>Fecha: 2025</span>
  </div>
  <div style="margin-top:8px;">
    <span class="pill">DHCP</span>
    <span class="pill">DNS</span>
    <span class="pill">NGINX</span>
    <span class="pill">VSFTPD</span>
    <span class="pill">Docker</span>
  </div>
  <div class="toolbar">
    <button onclick="window.print()">Imprimir / PDF</button>
  </div>
</div>
${sourceSection.innerHTML}
</body>
</html>`;

                const printWindow = window.open('', '_blank');
                if (!printWindow) throw new Error('La ventana emergente fue bloqueada');
                printWindow.document.open();
                printWindow.document.write(printableHtml);
                printWindow.document.close();
                printWindow.onload = function () {
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        if (status) {
                            status.textContent = 'Lista la ventana para guardar como PDF.';
                            status.style.color = '#48bb78';
                        }
                    }, 300);
                };
            } catch (error) {
                console.error('Error:', error);
                if (status) {
                    status.textContent = `Error al preparar el informe: ${error.message}`;
                    status.style.color = '#e53e3e';
                }
            } finally {
                if (btn) { btn.disabled = false; btn.textContent = 'Descargar Informe PDF'; }
            }
        }

        // Carrusel
        (function initCarousel() {
            const track = document.getElementById('carouselTrack');
            const dotsContainer = document.getElementById('carouselDots');
            const prevBtn = document.getElementById('prevSlide');
            const nextBtn = document.getElementById('nextSlide');
            if (!track || !dotsContainer || !prevBtn || !nextBtn) return;

            const slides = Array.from(track.children);
            let index = 0;

            function renderDots() {
                dotsContainer.innerHTML = '';
                slides.forEach((_, i) => {
                    const d = document.createElement('button');
                    d.className = 'dot' + (i === index ? ' active' : '');
                    d.setAttribute('aria-label', 'Ir a la diapositiva ' + (i + 1));
                    d.addEventListener('click', () => goto(i));
                    dotsContainer.appendChild(d);
                });
            }

            function update() {
                track.style.transform = `translateX(-${index * 100}%)`;
                const allDots = dotsContainer.querySelectorAll('.dot');
                allDots.forEach((dot, i) => dot.classList.toggle('active', i === index));
            }

            function goto(i) {
                index = (i + slides.length) % slides.length;
                update();
            }

            prevBtn.addEventListener('click', () => goto(index - 1));
            nextBtn.addEventListener('click', () => goto(index + 1));

            renderDots();
            update();
        })();

        // Navegación rápida: activar pestaña Informe Técnico y mover carrusel a la sección
        (function initQuickNav() {
            const serviciosTabBtn = document.getElementById('tab-servicios-btn');
            const track = document.getElementById('carouselTrack');
            const dots = () => Array.from(document.querySelectorAll('#carouselDots .dot'));
            if (!serviciosTabBtn || !track) return;

            const anchorToIndex = new Map([
                ['servicios-dhcp', 0],
                ['servicios-dns', 1],
                ['servicios-nginx', 2],
                ['servicios-vsftpd', 3],
            ]);

            function goToSlide(i) {
                const ds = dots();
                if (ds[i]) ds[i].click();
            }

            function handleAnchorNav(e) {
                const href = e.currentTarget.getAttribute('href') || '';
                if (!href.startsWith('#')) return;
                const id = href.replace('#', '');
                if (!anchorToIndex.has(id)) return;
                e.preventDefault();
                activateTab(serviciosTabBtn);
                requestAnimationFrame(() => goToSlide(anchorToIndex.get(id)));
            }

            // Los enlaces de navegación rápida se eliminaron junto con el héroe
        })();
    </script>
</body>
</html>